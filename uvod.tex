Současná modelová kolejiště již dávno nejsou jen hračkou malých dětí
a jejich rodičů. Jsou to plnohodnotné modely, na kterých se dispečeři reálné
železnice učí řídit dopravu a které slouží pro výuků oborů automatizace.
Kolejiště jsou vybavena robustní a spolehlivou zabezpečovací technikou
podobnou té, která se v~současnosti používá na skutečné železnici.

Se zvyšujícími se nároky na bezpečnost provozu vzniká nutnost procesy řízení
automatizovat, eliminovat lidský faktor a řízení kolejiště obecně
zrychlit. Cílem této práce je pomocí automatizace procesu kalibrace modelového
železničního vozidla přispět právě ke zvýšení bezpečnosti a spolehlivosti
provozu.

Autor rozebere možnosti řešení problému automatické kalibrace, ukáže, proč jsou
současná řešení nevhodná a nakonec navrhne (1) hardware, (2) firmware a (3)
software, kterými uvedený problém řeší. Autor demonstruje výstupy této práce
v~praxi a ukáže její reálný přínos.

Tato práce se tematicky pohybuje na pomezí práce typu \textit{proof of concept}
a práce \textit{aplikační}. Jejím primárním cílem je vytvořit reálné řešení
reálného problému v~oblasti automatizace, konkrétně v~oblasti řízení dopravy na
modelovém kolejišti. Jakkoliv se může zdát, že toto téma se nachází velice
blízko hardwaru, primárním cílem této práce je navrhnout kvalitní softwarové
řešení.

Pro přesnou formulaci problému automatické kalibrace železničního vozidla je
nutné pochopit kontext této práce, o~kterém pojednává tato kapitola.

\section{Modelová kolejiště}

Modelové kolejiště je model reálné železniční tratě, typicky zmenšený
v~některém ze standardních měřítek, např. v~měřítku \uv{TT} (1:120). Vedle
typického \uv{hobby} využití kolejiště často slouží jako dopravní trenažéry pro
výuku zabezpečovacích zařízení železnice či dalších aspektů využívaných na
skutečné železnici. Nejen v~těchto případech vzniká potřeba kolejiště ovládat
\textit{zabezpečovacím zařízením}. Typickým zástupcem současného
zabezpečovacího zařízení na skutečné železnici je \textit{elektronické
stavědlo} spolu s~grafickou nadstavbou \textit{JOP}\footnote{Jednotné obslužné
pracoviště}, která umožňuje řízení stavědla přes počítač.

Obdobný systém je využíván také v~\textit{Klubu modelářů železnic Brno I}.
V~tomto klubu je nasazen systém řízení kolejišť zvaný \textit{hJOP}
\cite{hjop:web}, který je klonem JOP upraveným pro potřeby řízení modelu. Jeho
primárním cílem je povelovat jízdu vlaku a omezením lidského faktoru předejít
možným kolizím.

\section{Současné trendy v~řízení kolejiště}

K~řízení modelových kolejišť je v~současné době napříč zeměmi využívána celá
řada dostupných SW. Typickými příklady jsou například \textit{JMRI}
\cite{jmri:web}, \textit{TrainController} \cite{traincontroller:web}
nebo český SW \textit{modelJOP} \cite{modeljop:web}.

Výše zmíněné aplikace komunikují s~hardwarovými prvky kolejiště.
Nejdůležitějším z~těchto prvků je digitální centrála DCC. Digitální centrála je
obecný pojem, konkrétními instancemi od jednotlivých výrobců jsou pak např.
\textit{Z21} \cite{z21:web}, \textit{NanoX} \cite{nanox:web} nebo třeba
\textit{Intellibox} \cite{intellibox:web}. Centrála nejčastěji komunikuje
s~počítačem pomocí sběrnice \textit{RS232 over USB}. Jejím hlavním úkolem je
vytvářet \textit{digitální signál DCC}, který moduluje do kolejí.

Lokomotiva stojící na kolejích tento signál dekóduje pomocí spe\-ciál\-ní
součástky -- tzv. \textit{dekodéru} -- a podle přijatých dat poveluje periferie
lokomotivy: motor, světla, nebo třeba zvuk vydávaný vestavěným reproduktorem.
Signál v~kolejích je zároveň využíván jako výkonový (např. pro napájení
motoru). Dekodér v~podstatě obsahuje jen jednoduchý mikrokontrolér a několik
výkonových prvků. Jeho typická velikost je v~řádu malých jednotek $cm^2$, takže
je skutečně malý.

Každý dekodér má svoji adresu v~rozsahu $1$--$9999$. Počítač pak může vydat příkaz
pro řízení lokomotivy, např.: \textit{\uv{lokomotivo s~adresou 562, jeď směrem
vpřed rychlostí 15!}}

\section{Synchronizace rychlosti vozidel}

Rychlost lokomotivy typicky bývá přirozené číslo v~rozsahu $0$--$28$. Tato
hodnota se označuje jako tzv. \textit{jízdní stupeň}.

Protože každá lokomotiva obsahuje jiné mechanické prvky (převody, motor),
odpovídá stejnému jízdnímu stupni u~dvou různých hnacích vozidel různá
rychlost. Ukazuje se, že při řízení kolejiště je vhodné spárovat jízdní stupeň
s~reálnou rychlostí vozidla. Je to především proto, abychom dosáhli modelové
věrnosti a vozidlo se po přepočtu pohybovalo \textit{modelovou rychlostí}. Je
také nutné dbát na provozní parametry kolejiště, které umožňují průjezd
některými části kolejiště jen omezenou rychlostí. Při překročení této rychlosti
by pak mohlo dojít k~vykolejení, což je samozřejmě nežádoucí.

Dalším důvodem pro spárování rychlosti lokomotivy s~jízdním stupněm je
vytvoření předvídatelného prostředí pro obsluhu. Obsluha má často k~dispozici
ovladač pro řízení rychlosti jízdy vozidla v~ručním režimu. Autor této práce
považuje za velice užitečné, aby platilo, že otočení trimru ovladače o~daný
úhel způsobí u~všech vozidel pohyb stejnou rychlostí.

Třetím důvodem k~synchronizaci rychlostí vozidel je umožnění přípřeží a postrků
-- tj.  situací, kdy v~jednom vlaku jede více lokomotiv. Tyto lokomotivy se
musí pohybovat stejnou rychlostí, jinak hrozí vykolejení vlaku.

\subsection{Současné řešení problému}

Současné řídicí programy problém synchronizace rychlostí typicky řeší tak, že
si u~každého hnacího vozidla ukládají tabulku \textit{jízdní stupeň: skutečná
rychlost}. Když tyto programy chtějí, aby dvě lokomotivy jely stejnou rychlostí,
vyhledají příslušné jízdní stupně a do centrály (v~obecném případě) odešlou
dva různé jízdní stupně.

Provozu lokomotivy na kolejišti tak předchází buď

\begin{itemize}
	\item ruční zadání této tabulky, nebo
	\item automatické měření rychlosti lokomotivy.
\end{itemize}

Je však nutné podotknout, že toto řešení neuspokojuje naše požadavky pro
ruční řízení jízdy hnacího vozidla, protože tabulka rychlostí je uložena
pouze v~řídicím SW, s~kterým nebývají ovladače propojeny, takže nemohou tabulku
využít.

\subsection{Řešení problému v~hJOP}

Alternativním řešením problému synchronizace rychlostí je způsob, který
v~současné době využívá SW hJOP. Tato práce cílí právě na tento alternativní
způsob řešení kalibrace. Jeho výhoda je v~tom, že řeší synchronizaci
rychlostí i~pro ruční ovladače.

V~každém lokomotivním dekodéru je možno pro každý z~28 jízdních stupňů nastavit
konkrétní výkon motoru. SW hJOP staví na předpokladu, že uživatel provede před
provozem hnacího vozidla tzv. \textit{kalibraci}, tj. přiřazení výkonu motoru
každému rychlostnímu stupni každého vozidla tak, aby bylo splněno, že konkrétní
jízdní stupeň odpovídá u~všech vozidel konkrétní rychlosti.

Příklad: u~všech lokomotiv platí, že jízdní stupeň $15$ odpovídá reálné
rychlosti $40\ km/h$.

Dalšími výhodami tohoto řešení jsou:

\begin{enumerate}
	\item odpadnutí nutnosti udržovat si u~každého vozidla v~SW kalibrační
	tabulku a
	\item instantní přenos tabulky mezi kolejišti, když je přenesena
	lokomotiva (to proto, že tabulka je jednoduše fyzicky uložená v~lokomotivě,
	a tudíž logicky cestuje s~ní).
\end{enumerate}

Nevýhodou tohoto přístupu je, že je nutné provést netriviální proces kalibrace.
V~současné době tento proces zahrnuje ježdění s~lokomotivou na měřicím okruhu,
měření její rychlosti a ruční nastavování kalibrační tabulky.

Cílem této práce je tento proces automatizovat.

\section{Cíl práce}

Cílem této práce je automatizovat proces kalibrace lokomotivy.

Nejprve je nutné navrhnout metodu pro měření rychlosti hnacího vozidla a
zabezpečit přenos dat o~rychlosti do řídicího PC. Poté je nutné navrhnout SW,
který na nákladě změřené rychlosti nastaví kalibrační tabulky hnacího vozidla.

Výstupem této práce je řešení, které umožní proces kalibrace především
automatizovat, což povede k~ušetření lidských kapacit. Dále umožní proces
kalibrace zrychlit, což přispěje k~minimalizaci režijního času spojeného
s~provozem kolejiště, a zároveň proces kalibrace zpřesnit, což povede ke
zvýšení spolehlivosti provozu na kolejišti.
