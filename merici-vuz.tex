Tato kapitola popisuje celkovou koncepci vlastního senzoru pro měření
rychlosti hnacího vozidla -- tzv. měřicího vozu. Tato kapitola popisuje
a zdůvodňuje rozhodnutí, která autor při konstrukci senzoru zvolil.

V~kontextu této kapitoly si autor dovoluje stručně připomenout Požadavky
na řešení (TODO: link chapter 2).

\section{Umístění senzoru}

Uvědomme si nejprve, kam je a není možno senzor umístit. Určitě platí, že
senzor není možné umístit do lokomotivy. Lokomotiva je totiž komerční produkt,
který umožňuje úpravy elektroniky uvnitř nejvýše na úrovní výměny digitálního
dekodéru DCC. Lokomotiva obvykle bývá vybavena deskou plošných spojů, která
připojuje jednotlivé součásti lokomotivy (motor, koleje, dekodér, osvětlení,
...). Tato deska je specifická pro konkrétní model a dodává ji výrobce hnacího
vozidla. Není tedy prakticky možné do elektroniky lokomotivy nějak zasáhnout.

Další možností je doplnit senzor do lokomotivy bez úpravy její elektroniky.
To s sebou ale nese pořád tu nevýhodu, že je třeba mechanicky zasahovat do
(poměrně drahé) lokomotivy.

Další možností je umístit senzor mimo hnací vozidlo. Tento senzor může být
umístěn na kolejiště staticky (podobně jako v \ref{senzor}) nebo může
být součástí vagónu připojeného za lokomotivou. Statický senzor se jeví jako
nevyhovující zejména proto, že neumožňuje provádění dokalibrace za skutečného
provozu.

Nejvhodnějším řešením se tedy jeví vyrobit vůz, který se připojí ke kalibrované
lokomotivě jako běžný vagón. Součástí tohoto vozu bude senzor pro měření
rychlosti. Vůz pak bude možné připojit bez narušení provozu i~za vlak na
produkčním kolejišti.

S uvážením výše uvedených argumentů se autor rozhodl vydat cestou
\textit{měřicího vozu}.

\section{Senzor}

Hlavní součásti měřicího vozu je nesporně rychlostní senzor. Zvolená
technologie senzoru má vliv na formát a přesnost měření, dále má vliv na
mechanicko-elektrické vlastnosti měřicího vozu, jeho cenu, snadnost výroby,
opakovatelnost výroby s výhledem na několik let a v neposlední řadě poruchovost
a servisovatelnost měřicího vozu.

Autor uvážil několik dostupných technologií senzorů.

\subsection{Magnetický senzor}

První možnou technologií senzoru jsou tzv. \textit{magnetické poziční senzory}.
Tyto senzoru fungují na bázi halových sond. Umí měřit úhel natočení objektu
vzhledem k senzoru. Jejich primárním účelem je měřit natočení nejrůznějších
ramen, či prvků ovládaných např. servomotory, opakovaným měřením natočení lze
ale dosáhnout velice přesného měření rychlosti. Princip těchto senzorů
dobře ilustruje obrázek \ref{fig-magnetic-sensor}.

TODO obrázek.

Výhodou tohoto měření je velice vysoká přesnost (řádově 10 bitů na jednu otáčku
-- TODO je to pravda?). Bohužel, při pohledu na obrázek
\ref{fig-magnetic-sensor} je velice těžko představitelné, jak umístit senzor na
nápravu vagónu. Senzor by musel být umístěn z boku vozu, což by výrazně
snižovalo jeho stabilitu.

Existují ale i senzory, které se montují přímo na osu rotujícího předmětu
(TODO: link). Takové by pro náš účel byly nejvhodnější. Smutným faktem ale je,
že tyto senzory vyžadují magnet o~tak velké velikosti, že jsou pro modelovou
železnici nepoužitelné.

\subsection{Optický senzor}

Druhou uvažovanou technologií senzoru je optický senzor, který je každému
důvěrně známý z optických myší. Tento senzor pracuje na principu snímání obrazu
podložky CCD čipem a porovnávání dvou obrazů pořízených v krátkém časovém
intervalu. Ze dvou obrazů je pak určen rozdíl polohy myši.
\footnote{Zajímavostí je, že celá logika porovnávání dvou obrazů je
v~takovýchto senzorech implementována hardwarově.}

Toto řešení vypadá velice slibně, jeho obrovskou výhodou je absence jakýchkoliv
mechanických částí. Stačí namířit senzor na pražce a prostě měřit jak se vůz
pohybuje. Pražce jsou navíc velice dobře kontrastní vůči štěrku, který je mezi
nimi, porovnávání obrazů by tak mohlo být velice přesné (srovnejte s~pohybem
optické myši po takřka uniformním povrchu stolu nebo podložky pod myš).

Pro kalibrační vůz byl vybrán konkrétní senzor ADNS-3050. Kritériem výběru
bylo to, že (1) senzor má výstup sériovou linkou a že (2) senzor zvládá měřit
vysoké rychlosti (vagón se typicky pohybuje o~něco rychleji než myš).

Autor nakoupil senzory, osadil je na desku plošných spojů a začal testovat
přesnost měření pomocí jednoduchého zapojení s vývojovým kitem Arduino. Velikou
výzvou bylo sehnat čočku, která autorovi umožní zaměřit pražce a zároveň
ponechat senzor na ploše vagónu. Díky spolupráci s Ústavem přístrojové techniky
AV ČR se však povedlo dostatečně malou čočku úspěšně sehnat.

První měření ukázala, že pro dobrou funkci senzoru je třeba poměrně kontrastní
snímaná plocha a poměrně intenzivní červené světlo (na to je CCD čip v~senzoru
nejcitlivější \footnote{Proto si optická myš přisvětluje červeným světlem.})
Navíc se ukázalo, že hloubka ostrosti senzoru je nejvýše $1\ mm$, což reálně
znemožňovalo měřit rychlosti na kolejích, které nejsou zasypány štěrkem, ale
pouze připevněny k~podložce.

Po několika měsících pokusů o zprovoznění měření optickým senzorem autor naznal,
že s tímto typem senzoru nebude schopen garantovat přesně a spolehlivé měření.
Padlo tedy rozhodnutí tuto technologii opustit. Autor by rád zdůraznil, že
jednou z hlavních motivací pro opuštění této technologie byla přílišná
komplexnost toho, co se děje v senzoru, a neschopnost ovlivňování a debugování
těchto procesů.

TODO: images, link ADNS sensor

---

TODO: shrnout vlatnosti, které měly vliv na konstrukci
